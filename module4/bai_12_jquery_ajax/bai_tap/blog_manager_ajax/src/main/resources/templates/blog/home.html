<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="/blog/layout :: head">
</head>
<body>
<h3>Blog List</h3>
<p>
    <a class="btn btn-primary"
       th:href="@{/create}"
       role="button" style="margin-left: 20%">Add new blog
    </a>
    <a class="btn btn-primary"
       th:href="@{/category}"
       role="button" style="margin-left: 20%">Category
    </a>
</p>
<form id="searchByName" th:action="search_name">
    Search by name:
    <input id="name" name="nameBlog" type="text"/>
    <input type="submit" value="Search"/>
</form>
<br/>
<form th:action="search_category">
    <label>Category: </label>
    <select name="id">
        <option th:each="category : ${categories}" th:value="${category.id}" th:text="${category.categoryName}"></option>
    </select>
    <input type="submit" value="Search"/>
</form>
<div class="notify">
    <div th:if="${message}">
        <span th:text="${message}"></span>
    </div>
</div>
<table id="blog">
    <thead>
    <tr>
        <th>Name</th>
        <th>Title</th>
        <th>Category</th>
        <th>Type</th>
        <th>BLog Writer</th>
        <th>Date Update</th>
        <th>Edit</th>
        <th>Delete</th>
        <th>View</th>
    </tr>
    </thead>
    <tbody id="listBlog">
    </tbody>
</table>

<footer th:replace="/blog/layout :: footer"></footer>
</body>
<script src="jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"
        integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF"
        crossorigin="anonymous"></script>
<script>
    $(document).ready(function (event) {
        $.ajax({
            headers: {
                'Accept': "application/json",
                'Content-Type': 'application/json'
            },
            type: "GET",
            url: "http://localhost:8080/",
            dataType: "json",
            success: function (blogList) {
                console.log(blogList);
                for (let i = 0; i < blogList.length; i++) {
                    let row = "<tr>";
                    row += "<td>" + blogList[i].blogName + "</td>";
                    row += "<td>" + blogList[i].titleBlog + "</td>";
                    row += "<td>" + blogList[i].category.categoryName + "</td>";
                    row += "<td>" + blogList[i].typeBlog + "</td>";
                    row += "<td>" + blogList[i].blogWriter + "</td>";
                    row += "<td>" + blogList[i].dateUpdate + "</td>";
                    row += "<td><a href=/edit/" + blogList[i].id + ">Edit</a></td>";
                    row += "<td><a href=/delete/" + blogList[i].id + ">Delete</a></td>";
                    row += "<td><a href=/view/" + blogList[i].id + ">View</a></td>";
                    row += "</tr>";
                    $('#listBlog').html(row);
                }
            },
            error: function (event) {
                console.log("Fail");
            }
        })
    });
</script>
</html>